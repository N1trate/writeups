<!doctype html><html><head><title>Nitrate's writeups</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2022-05-22T19:38:17 UTC"><title>Portobello - Anger :: Nitrate's writeups</title><link rel="shortcut icon" href=/writeups/images/favicon.png type=image/x-icon><link href=/writeups/css/nucleus.css rel=stylesheet><link href=/writeups/css/font-awesome.min.css rel=stylesheet><link href=/writeups/css/featherlight.min.css rel=stylesheet><link href=/writeups/css/auto-complete.css rel=stylesheet><link href=/writeups/theme-flex/style.css rel=stylesheet><link rel=stylesheet href=/writeups/css/bootstrap.min.css><link rel=stylesheet href=/writeups/css/custom.css></head><body data-url=/writeups/nsec-2022/portobello-anger/><header><div class=logo><a class=baselink href=https://n1trate.github.io/writeups>Nitrate's writeups</a></div><div class=burger><a href=javascript:void(0); style=font-size:15px>&#9776;</a></div></header><article><aside><ul class=menu><li data-nav-id=/writeups/ class=dd-item><a href=/writeups/><i class="fa fa-fw fa-home"></i></a></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/ class="dd-item alwaysopen haschildren"><div><a href=/writeups/nsec-2022/>NSec 2022</a>
<i class="fa fa-angle-down fa-lg category-icon"></i></div><ul><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-denial/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-denial/>Portobello - Denial</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-depression/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-depression/>Portobello - Depression</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-bargaining/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-bargaining/>Portobello - Bargaining</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-anger/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-anger/>Portobello - Anger</a></div></li></ul></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/ class="dd-item alwaysopen haschildren"><div><a href=/writeups/nsec-2022-warmup/>NSec 2022 WarmUp</a>
<i class="fa fa-angle-down fa-lg category-icon"></i></div><ul><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/kitty/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/kitty/>Kitty!</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/warmup-challenge-logically/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/warmup-challenge-logically/>Warmup challenge, logically</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/the-flag-is-a-secret/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/the-flag-is-a-secret/>The Flag Is A Secret</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/toque-tracking/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/toque-tracking/>Toque Tracking</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/northsec-flag-token/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/northsec-flag-token/>NorthSec Flag Token</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/vlc-of-the-mariner/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/vlc-of-the-mariner/>VLC of the Mariner</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/whamazon/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/whamazon/>Whamazon</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/warmup-flag-actual/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/warmup-flag-actual/>warmup flag (actual)</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/hidden-harware-secrets/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/hidden-harware-secrets/>Hidden Hardware Secrets</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/fuzzforfun/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/fuzzforfun/>FuzzForFun</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/montr%C3%A9al-remix/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/montr%C3%A9al-remix/>Montréal Remix</a></div></li></ul></li><li data-nav-id=https://n1trate.github.io/writeups/tools/ class="dd-item alwaysopen"><div><a href=/writeups/tools/>Tools</a></div></li></ul><section></section></aside><section class=page><div class=nav-select><center>Navigation :
<select onchange="location.href=this.value"><option value=/writeups/nsec-2022/>
NSec 2022</option><option value=/writeups/nsec-2022/portobello-denial/>
-
Portobello - Denial</option><option value=/writeups/nsec-2022/portobello-depression/>
-
Portobello - Depression</option><option value=/writeups/nsec-2022/portobello-bargaining/>
-
Portobello - Bargaining</option><option value=/writeups/nsec-2022/portobello-anger/ selected>
-
Portobello - Anger</option><option value=/writeups/nsec-2022-warmup/>
NSec 2022 WarmUp</option><option value=/writeups/nsec-2022-warmup/kitty/>
-
Kitty!</option><option value=/writeups/nsec-2022-warmup/warmup-challenge-logically/>
-
Warmup challenge, logically</option><option value=/writeups/nsec-2022-warmup/the-flag-is-a-secret/>
-
The Flag Is A Secret</option><option value=/writeups/nsec-2022-warmup/toque-tracking/>
-
Toque Tracking</option><option value=/writeups/nsec-2022-warmup/northsec-flag-token/>
-
NorthSec Flag Token</option><option value=/writeups/nsec-2022-warmup/vlc-of-the-mariner/>
-
VLC of the Mariner</option><option value=/writeups/nsec-2022-warmup/whamazon/>
-
Whamazon</option><option value=/writeups/nsec-2022-warmup/warmup-flag-actual/>
-
warmup flag (actual)</option><option value=/writeups/nsec-2022-warmup/hidden-harware-secrets/>
-
Hidden Hardware Secrets</option><option value=/writeups/nsec-2022-warmup/fuzzforfun/>
-
FuzzForFun</option><option value=/writeups/nsec-2022-warmup/montr%C3%A9al-remix/>
-
Montréal Remix</option><option value=/writeups/tools/>
Tools</option></select></center></div><div><div class=searchbox><input data-search-input id=search-by type=text placeholder=Search...></div></div><h1>Portobello - Anger</h1><p>Challenge statement:</p><pre tabindex=0><code>YOU HAVE NO RIGHTS TO USE THE DNS PROTOCOL MALICIOUSLY. Respect the RFCs spirit like any good technology user would.
Our vendor guaranteed us that nothing could get stolen from the Mycoverse and I still believe him.
Because any data leaving or entering the Mycoverse goes through our AI-backed deep packet inspection appliance, we have never had any user misuse our technologies.

They have no need to do so because anything a user would want is acquireable through our online store.

My AI appliance alerted me numerous time about large DNS responses from a single domain name but I deleted these alerts as false positives.
I don’t want to sound like a broken record but we both know that DNS is a benign protocol.

You can still try to find the traffic, I bet it is still happening.

Rosie Meyer - A+, Server+, CCNA, CCNP, CCIE, MSDST, CSM
Network Admin
</code></pre><p>We still need to download the same <a href=../portobello53.pcapng>pcap</a>.</p><p>The large DNS responses that the challenge statement is talking about can be found in the TXT records. We can see a lot of query and responses for TXT records in the why-pay-for-bits-when-you-can-drop-the-beats.ctf.<br><img src=1.png alt=1.png></p><p>Taking the first one, we can see that the content of the TXT response look like a base64 blob.<br><img src=2.png alt=2.png></p><p>We can use base64 to get some clear-ish text:</p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#fff;font-weight:700>echo</span> <span style=color:#0ff;font-weight:700>&#34;SUQzAwAAAAABFFRQRTEAAAAQAAAAUzNSTCBmdCBLcnlzdGFsVElUMgAAABYAAABUcmlwcGluZyBvbiBNdXNocm9vbXNDT01NAAAAIwAAAAAAAABmbGFnLXJhZGlvLW15Y292ZXJzZS1pcy1hLXNjYW1DT01NAAAAIwAAAFhYWABmbGFnLXJhZGlvLW15Y292ZXJzZS1pcy1hLXNjYW3/+5REAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#34;</span> | base64 -d
</span></span><span style=display:flex><span>ID3TPE1S3RL ft KrystalTIT2Tripping on MushroomsCOMM#flag-radio-mycoverse-is-a-scamCOMM#XXXflag-radio-mycoverse-is-a-scam���D
</span></span></code></pre></div><p>We can see the first flag in there.</p><blockquote><p>flag-radio-mycoverse-is-a-scam</p></blockquote><p>Flag submission:</p><pre tabindex=0><code>Portobello 53 - Anger (1/2)      |     1 | This user did not buy this art on the Mycoverse (1/2)
</code></pre><p>Forum message:</p><pre tabindex=0><code>What is that user downloading illegaly from a non-official server?
</code></pre><p>We can see that the previous blob was binary, and started with ID3. We can have a better look at it by sending it to hexdump -C:<br><img src=3.png alt=3.png></p><p>ID3 is a metadata container usually used in MP3. We can try to extract all the TXT record and create a single file out of them with this script:</p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#fff;font-weight:700>from</span> scapy.all <span style=color:#fff;font-weight:700>import</span> *
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>import</span> base64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>raw = sniff(offline=<span style=color:#0ff;font-weight:700>&#34;portobello53.pcapng&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>data = <span style=color:#0ff;font-weight:700>b</span><span style=color:#0ff;font-weight:700>&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>for</span> packet in raw:
</span></span><span style=display:flex><span>    <span style=color:#fff;font-weight:700>if</span> packet[IPv6].src == <span style=color:#0ff;font-weight:700>&#39;fd00:6e73:6563:3232::100&#39;</span> and <span style=color:#0ff;font-weight:700>b</span><span style=color:#0ff;font-weight:700>&#39;why-pay-for-bits-when-you-can-drop-the-beats&#39;</span> in packet[DNS].qd.qname and packet[DNS].ancount &gt; <span style=color:#ff0;font-weight:700>0</span>:
</span></span><span style=display:flex><span>        data = data + packet[DNS].an.rdata[<span style=color:#ff0;font-weight:700>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>with</span> <span style=color:#fff;font-weight:700>open</span>(<span style=color:#0ff;font-weight:700>&#39;output&#39;</span>, <span style=color:#0ff;font-weight:700>&#39;wb&#39;</span>) <span style=color:#fff;font-weight:700>as</span> f:
</span></span><span style=display:flex><span>    f.write(base64.b64decode(data))
</span></span></code></pre></div><p>We can now use the file command to make sure what type of file it is:</p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ file output
</span></span><span style=display:flex><span>output: Audio file with ID3 version 2.3.0, contains:MPEG ADTS, layer III, v1, <span style=color:#ff0;font-weight:700>128</span> kbps, <span style=color:#ff0;font-weight:700>48</span> kHz, JntStereo
</span></span></code></pre></div><p>It&rsquo;s a bit hard to hear correctly, but when opening the <a href=output>file</a> in an audio player, we can hear the last flag (SOUND WARNING).</p><blockquote><p>flag-radiocashmoneymushroom247</p></blockquote><p>Flag submission:</p><pre tabindex=0><code>Portobello 53 - Anger (2/2)      |     2 | When the beat drops, expect the stocks to do the same. This gives me grief. (2/2)
</code></pre><p>Forum message:</p><pre tabindex=0><code>Listening to pirated radio channel from within the Mycoverse. I will let Eva and Anatoli know that we are missing out on profit.
</code></pre><div class=chevrons><div id=navigation></div></div></section></article><footer><div class=footline></div><div><p>Weeeeeeeeeeeeeeee</p></div></footer><script src=/writeups/js/jquery-2.x.min.js></script>
<script type=text/javascript>var baseurl="https://n1trate.github.io/writeups"</script><script src=/writeups/js/clipboard.min.js></script>
<script src=/writeups/js/featherlight.min.js></script>
<script type=text/javascript src=/writeups/js/lunr.min.js></script>
<script type=text/javascript src=/writeups/js/auto-complete.js></script>
<script type=text/javascript src=/writeups/js/search.js></script>
<script src=/writeups/theme-flex/script.js></script>
<script src=https://n1trate.github.io/writeups/js/scripts.min.js></script></body></html>