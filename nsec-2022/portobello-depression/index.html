<!doctype html><html><head><title>Nitrate's writeups</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2022-05-22T19:04:50 UTC"><title>Portobello - Depression :: Nitrate's writeups</title><link rel="shortcut icon" href=/writeups/images/favicon.png type=image/x-icon><link href=/writeups/css/nucleus.css rel=stylesheet><link href=/writeups/css/font-awesome.min.css rel=stylesheet><link href=/writeups/css/featherlight.min.css rel=stylesheet><link href=/writeups/css/auto-complete.css rel=stylesheet><link href=/writeups/theme-flex/style.css rel=stylesheet><link rel=stylesheet href=/writeups/css/bootstrap.min.css><link rel=stylesheet href=/writeups/css/custom.css></head><body data-url=/writeups/nsec-2022/portobello-depression/><header><div class=logo><a class=baselink href=https://n1trate.github.io/writeups>Nitrate's writeups</a></div><div class=burger><a href=javascript:void(0); style=font-size:15px>&#9776;</a></div></header><article><aside><ul class=menu><li data-nav-id=/writeups/ class=dd-item><a href=/writeups/><i class="fa fa-fw fa-home"></i></a></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/ class="dd-item alwaysopen haschildren"><div><a href=/writeups/nsec-2022/>NSec 2022</a>
<i class="fa fa-angle-down fa-lg category-icon"></i></div><ul><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-denial/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-denial/>Portobello - Denial</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-depression/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-depression/>Portobello - Depression</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-bargaining/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-bargaining/>Portobello - Bargaining</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-anger/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-anger/>Portobello - Anger</a></div></li></ul></li><li data-nav-id=https://n1trate.github.io/writeups/tools/ class="dd-item alwaysopen"><div><a href=/writeups/tools/>Tools</a></div></li></ul><section></section></aside><section class=page><div class=nav-select><center>Navigation :
<select onchange="location.href=this.value"><option value=/writeups/nsec-2022/>
NSec 2022</option><option value=/writeups/nsec-2022/portobello-denial/>
-
Portobello - Denial</option><option value=/writeups/nsec-2022/portobello-depression/ selected>
-
Portobello - Depression</option><option value=/writeups/nsec-2022/portobello-bargaining/>
-
Portobello - Bargaining</option><option value=/writeups/nsec-2022/portobello-anger/>
-
Portobello - Anger</option><option value=/writeups/tools/>
Tools</option></select></center></div><div><div class=searchbox><input data-search-input id=search-by type=text placeholder=Search...></div></div><h1>Portobello - Depression</h1><p>Challenge statement:</p><pre tabindex=0><code>What do you want again? Donâ€™t you think youâ€™ve caused enough harm to the company already?
Cyber security is only an expense. You canâ€™t profit from being secure. It is a money drain.

Our AI-based deep packet inspection appliance is guaranteed to prevent theft from the Mycoverse.

There is nothing left to uncover from the network traffic of the DNS server, I swear.
DNS is a safe protocol when you stick to ASCII characters and our appliance only supports this encoding.

Even if someone can infiltrate the Mycoverse, there is no way that they can get our intelectual property out of the network.

ðŸš© This is making me think ðŸ¤” Are the DNS queries made by our users only in ASCII?

Rosie Meyer - A+, Server+, CCNA, CCNP, CCIE, MSDST, CSM
Network Admin
</code></pre><p>We still need to download the same <a href=../portobello53.pcapng>pcap</a>.</p><p>Through the pcap, we can see some interesting queries being made that start with xn&ndash;. This type of encoding is named punycode and allows us to use unicode in places where you usually can&rsquo;t.<br><img src=1.png alt=1.png></p><p>We can use an online converter to get the unicode character out of them.<br><img src=2.png alt=2.png></p><p>To get a better look, we can filter only for the IP making those queries, fd00:6e73:6563:3232::9 and only for DNS queries of type CNAME.<br><img src=3.png alt=3.png></p><p>Doing the first few by hand, we get to the fifth one and find something that could look like the start of a flag.<br><img src=4.png alt=4.png></p><p>We now had to figure out which country each flag was, and replace the flags with the county&rsquo;s code from the unicode character. An easy way that I used was to paste them in discord, and hovering with the mouse to get the emoji&rsquo;s name. That way, we get most of the flag:</p><blockquote><p>FLAG-ART-SCRE??SH??-IS-??GITAL-TH??T</p></blockquote><p>We&rsquo;re missing a few flags, but we can guess the rest</p><blockquote><p>FLAG-ART-SCREENSHOT-IS-DIGITAL-THEFT</p></blockquote><p>Flag submission:</p><pre tabindex=0><code>Portobello 53 - Depression (1/3) |     2 | The Mycoverse needs itâ€™s own flag (1/3)
</code></pre><p>Forum message:</p><pre tabindex=0><code>The user found a way to exfiltrate informations using country flags? Where can I get a certification for this?
</code></pre><p>After that, I kept going and reading the other domains. It was pretty fun and got some like that one:<br><img src=5.png alt=5.png></p><p>I did a dozen or two by hand, and this is what I got:<br><img src=6.png alt=6.png><br><img src=7.png alt=7.png></p><p>At that point, that last line, I knew what it was&mldr; &ldquo;UPLOAD START&rdquo;&mldr; and no, I didn&rsquo;t want to keep doing it by hand. There was a total of 1223 packets that were containing a punycode CNAME&mldr;.</p><p>Time to bring out bash once again:</p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tshark -r portobello53.pcapng | grep libera | grep <span style=color:#0ff;font-weight:700>&#34;query 0x&#34;</span> | awk {<span style=color:#0ff;font-weight:700>&#39;print $12&#39;</span>}
</span></span></code></pre></div><p><img src=8.png alt=8.png></p><p>Sending them all in a file, we can use this <a href=https://seoengineoptimizations.com/seotools/idnconverter.php>Punycode Converter</a> to do more than one at a time. Loading the file with &ldquo;Import Urls&rdquo; and selecting &ldquo;Punycode to IDN&rdquo;.
<img src=9.png alt=9.png></p><p>Scrolling down, we can start to see some form that are letters. Here&rsquo;s the first one:<br><img src=10.png alt=10.png></p><p>By zooming the way down to 25% we can get a better view.<br><img src=11.png alt=11.png></p><p>By the way, the mushroom at the start are now very nice looking!#
<img src=12.png alt=12.png></p><p>We can keep reading the flag, as such:<br><img src=13.png alt=13.png></p><p>We then end up with:</p><blockquote><p>FLAG-ART-MUSHROOM-ARE-HIDDEN-IN-PLAIN-SIGHT</p></blockquote><p>Flag submission:</p><pre tabindex=0><code>Portobello 53 - Depression (2/3) |     1 | Is a VFT screenshot actually art theft? (2/3)
</code></pre><p>Forum message:</p><pre tabindex=0><code>Users are stealing artwork and VFTs from the Mycoverse. I need to tell the cyberpolice.
</code></pre><p>At the absolute end, we get those:<br><img src=14.png alt=14.png></p><p>That last command is SLEEP, but before that, we can see a nice QR Code. I say nice, but trying to read it using 5 to 10 tools, including my phone, were all unsuccessful.<br><img src=15.png alt=15.png></p><p>Knowing that the first thing the readers need to parse a QR Code is to recognize the Finder Patterns, and the Alignment Pattern. I did a quick and dirty work in Pinta to make sure those were clear enough:<br><img src=16.png alt=16.png></p><p>With those modifications, my phone was able to read it and give me the last flag.</p><blockquote><p>FLAG-ART-EXFIL-METHOD-IS-TRUE-MASTERPIECE</p></blockquote><p>Flag submission:</p><pre tabindex=0><code>Portobello 53 - Depression (3/3) |     3 | Why invest in YRR when their art can be stolen that easily? Good grief. (3/3)
</code></pre><p>Forum message:</p><pre tabindex=0><code>That is another level of obfuscation that our AI-based appliance was not ready to deal with.
</code></pre><div class=chevrons><div id=navigation></div></div></section></article><footer><div class=footline></div><div><p>Weeeeeeeeeeeeeeee</p></div></footer><script src=/writeups/js/jquery-2.x.min.js></script>
<script type=text/javascript>var baseurl="https://n1trate.github.io/writeups"</script><script src=/writeups/js/clipboard.min.js></script>
<script src=/writeups/js/featherlight.min.js></script>
<script type=text/javascript src=/writeups/js/lunr.min.js></script>
<script type=text/javascript src=/writeups/js/auto-complete.js></script>
<script type=text/javascript src=/writeups/js/search.js></script>
<script src=/writeups/theme-flex/script.js></script>
<script src=https://n1trate.github.io/writeups/js/scripts.min.js></script></body></html>