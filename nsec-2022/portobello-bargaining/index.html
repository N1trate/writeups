<!doctype html><html><head><title>Nitrate's writeups</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2022-05-22T19:37:06 UTC"><title>Portobello - Bargaining :: Nitrate's writeups</title><link rel="shortcut icon" href=/writeups/images/favicon.png type=image/x-icon><link href=/writeups/css/nucleus.css rel=stylesheet><link href=/writeups/css/font-awesome.min.css rel=stylesheet><link href=/writeups/css/featherlight.min.css rel=stylesheet><link href=/writeups/css/auto-complete.css rel=stylesheet><link href=/writeups/theme-flex/style.css rel=stylesheet><link rel=stylesheet href=/writeups/css/bootstrap.min.css><link rel=stylesheet href=/writeups/css/custom.css></head><body data-url=/writeups/nsec-2022/portobello-bargaining/><header><div class=logo><a class=baselink href=https://n1trate.github.io/writeups>Nitrate's writeups</a></div><div class=burger><a href=javascript:void(0); style=font-size:15px>&#9776;</a></div></header><article><aside><ul class=menu><li data-nav-id=/writeups/ class=dd-item><a href=/writeups/><i class="fa fa-fw fa-home"></i></a></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/ class="dd-item alwaysopen haschildren"><div><a href=/writeups/nsec-2022-warmup/>NSec 2022 WarmUp</a>
<i class="fa fa-angle-down fa-lg category-icon"></i></div><ul><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/kitty/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/kitty/>Kitty!</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/warmup-challenge-logically/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/warmup-challenge-logically/>Warmup challenge, logically</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/the-flag-is-a-secret/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/the-flag-is-a-secret/>The Flag Is A Secret</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/toque-tracking/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/toque-tracking/>Toque Tracking</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/northsec-flag-token/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/northsec-flag-token/>NorthSec Flag Token</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/vlc-of-the-mariner/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/vlc-of-the-mariner/>VLC of the Mariner</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/whamazon/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/whamazon/>Whamazon</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/warmup-flag-actual/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/warmup-flag-actual/>warmup flag (actual)</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/hidden-harware-secrets/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/hidden-harware-secrets/>Hidden Hardware Secrets</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/fuzzforfun/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/fuzzforfun/>FuzzForFun</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022-warmup/montr%C3%A9al-remix/ class=dd-item><div><a href=/writeups/nsec-2022-warmup/montr%C3%A9al-remix/>Montréal Remix</a></div></li></ul></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/ class="dd-item alwaysopen haschildren"><div><a href=/writeups/nsec-2022/>NSec 2022</a>
<i class="fa fa-angle-down fa-lg category-icon"></i></div><ul><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-denial/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-denial/>Portobello - Denial</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-depression/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-depression/>Portobello - Depression</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-bargaining/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-bargaining/>Portobello - Bargaining</a></div></li><li data-nav-id=https://n1trate.github.io/writeups/nsec-2022/portobello-anger/ class=dd-item><div><a href=/writeups/nsec-2022/portobello-anger/>Portobello - Anger</a></div></li></ul></li><li data-nav-id=https://n1trate.github.io/writeups/tools/ class="dd-item alwaysopen"><div><a href=/writeups/tools/>Tools</a></div></li></ul><section></section></aside><section class=page><div class=nav-select><center>Navigation :
<select onchange="location.href=this.value"><option value=/writeups/nsec-2022-warmup/>
NSec 2022 WarmUp</option><option value=/writeups/nsec-2022-warmup/kitty/>
-
Kitty!</option><option value=/writeups/nsec-2022-warmup/warmup-challenge-logically/>
-
Warmup challenge, logically</option><option value=/writeups/nsec-2022-warmup/the-flag-is-a-secret/>
-
The Flag Is A Secret</option><option value=/writeups/nsec-2022-warmup/toque-tracking/>
-
Toque Tracking</option><option value=/writeups/nsec-2022-warmup/northsec-flag-token/>
-
NorthSec Flag Token</option><option value=/writeups/nsec-2022-warmup/vlc-of-the-mariner/>
-
VLC of the Mariner</option><option value=/writeups/nsec-2022-warmup/whamazon/>
-
Whamazon</option><option value=/writeups/nsec-2022-warmup/warmup-flag-actual/>
-
warmup flag (actual)</option><option value=/writeups/nsec-2022-warmup/hidden-harware-secrets/>
-
Hidden Hardware Secrets</option><option value=/writeups/nsec-2022-warmup/fuzzforfun/>
-
FuzzForFun</option><option value=/writeups/nsec-2022-warmup/montr%C3%A9al-remix/>
-
Montréal Remix</option><option value=/writeups/nsec-2022/>
NSec 2022</option><option value=/writeups/nsec-2022/portobello-denial/>
-
Portobello - Denial</option><option value=/writeups/nsec-2022/portobello-depression/>
-
Portobello - Depression</option><option value=/writeups/nsec-2022/portobello-bargaining/ selected>
-
Portobello - Bargaining</option><option value=/writeups/nsec-2022/portobello-anger/>
-
Portobello - Anger</option><option value=/writeups/tools/>
Tools</option></select></center></div><div><div class=searchbox><input data-search-input id=search-by type=text placeholder=Search...></div></div><h1>Portobello - Bargaining</h1><p>Challenge statement:</p><pre tabindex=0><code>While you were wasting your time on the DNS server trafic, I had Dr Harold Moon, our resident data scientist, verify if he could find anything out of the ordinary.
He’s not an expert and has no active certifications under his name but he wanted you to know that the host at address fd00:6e73:6563:3232::23 was the only one presenting anomalies.
I am not a data scientist and have no idea what anomalies are. It’s probably benign because the AI-backed deep packet inspection appliance did not flag anything.

Dr Moon said he observed a lot of unusual “back and forth” with this address.

No appliance alert = not suspicious in my book.

Rosie Meyer - A+, Server+, CCNA, CCNP, CCIE, MSDST, CSM
Network Admin
</code></pre><p>We still need to download the same <a href=../portobello53.pcapng>pcap</a>.</p><p>We can start by filtering the same way we did in Denial, but with the right IP address (fd00:6e73:6563:3232::23).<br><img src=1.png alt=1.png></p><p>We can see some interesting calls make, like packet 1053, where the query has the word &ldquo;echo&rdquo; in it. The subdomain to echo also look like a string we should be able to convert.</p><pre tabindex=0><code>0.7666742d7365637572652d7661756c742e7972722e636f7270.echo.474f415453.wpad.ctf
</code></pre><p><img src=2.png alt=2.png></p><p>The second section 7666742d7365637572652d7661756c742e7972722e636f7270 can be translated to vft-secure-vault.yrr.corp and the fourth one 474f415453 to GOATS. That one appears in every interesting request.</p><p>We can keep going by hand and finding other packets, like 1522, where the second value translate to rosie.meyer, but we should do it with some kind of script, else it will take a long time.</p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tshark -r portobello53.pcapng | grep wpad.ctf | grep <span style=color:#0ff;font-weight:700>&#34;query 0x&#34;</span> | awk {<span style=color:#0ff;font-weight:700>&#39;print $12&#39;</span>} | grep <span style=color:#fff;font-weight:700>echo</span> | cut -d. -f2 | xxd -r -p
</span></span></code></pre></div><p><img src=3.png alt=3.png></p><p>We can find out first flag in the middle, right after the wallet&rsquo;s private key.</p><blockquote><p>flag-blockchaiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiin</p></blockquote><p>It was actually the second flag, or the third one&mldr; I think there was a little issue with the numbering on that one.</p><p>Flag submission:</p><pre tabindex=0><code>Portobello 53 - Bargaining (3/3) |     2 | Losing this private key is not looking great (2/3)
</code></pre><p>I didn&rsquo;t go check the forums before finding the next flag, but there was a new message hinting us on how to do the last one.</p><p>Forum message:</p><pre tabindex=0><code>Our AI appliance was supposed to catch anything malicious and yet it let the private key to our wallet get leaked. This is bad for the company.

Can you also tell me which CVE was used to do priviledge escalation? I want to get ready to blame someone else.
Use this format: flag-bargaining_{MD5 hash of the string CVE-XXXX-YYYYYYYYYY} (without the {}).
</code></pre><p>For the first flag, I kept looking into wireshark and ended up around packet 2218 where we can clearly see some data in the hexadecimal reprensentation.<br><img src=4.png alt=4.png></p><p>Taking that packet and the next ones together, we can recreate the flag.</p><blockquote><p>FLAG-we_have_a_bad_case_of_ophiocordyceps_unilateralis</p></blockquote><p>Flag submission:</p><pre tabindex=0><code>Portobello 53 - Bargaining (1/3) |     2 | Why is that server returning commands? (1/3)
</code></pre><p>Forum message:</p><pre tabindex=0><code>The DNS server is definitely sending commands to the host. What could go wrong?
</code></pre><p>For the last flag, we had to find the message on the forum. We can see from other packets that we see a query to get the version of sudo, and an execution of sudo -u#-1 /bin/bash. Looking for that specific version of sudo that we got earlier (1.8.27), lead us to an <a href=https://www.exploit-db.com/exploits/47502>exploit-db</a> page informing us of the CVE : 2019-14287.<br><img src=5.png alt=5.png>
<img src=6.png alt=6.png></p><p>We can use md5sum to generate the hash and submit our last flag.</p><blockquote><p>flag-bargaining_739d80f289f091f1d5faf12cfd25fe83</p></blockquote><p>Flag submission:</p><pre tabindex=0><code>Portobello 53 - Bargaining (2/3) |     1 | A yes, a good old MITRE ATT@CK T1548. Give us ways to cope on grief. (3/3)
</code></pre><p>Forum message:</p><pre tabindex=0><code>Someone logged in as myself and managed to escalate their priviledges. Don’t tell the news.
</code></pre><div class=chevrons><div id=navigation></div></div></section></article><footer><div class=footline></div><div><p>Weeeeeeeeeeeeeeee</p></div></footer><script src=/writeups/js/jquery-2.x.min.js></script>
<script type=text/javascript>var baseurl="https://n1trate.github.io/writeups"</script><script src=/writeups/js/clipboard.min.js></script>
<script src=/writeups/js/featherlight.min.js></script>
<script type=text/javascript src=/writeups/js/lunr.min.js></script>
<script type=text/javascript src=/writeups/js/auto-complete.js></script>
<script type=text/javascript src=/writeups/js/search.js></script>
<script src=/writeups/theme-flex/script.js></script>
<script src=https://n1trate.github.io/writeups/js/scripts.min.js></script></body></html>