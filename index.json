[{"uri":"https://n1trate.github.io/writeups/nsec-2022/portobello-denial/","title":"Portobello - Denial","tags":[],"description":"","content":"Challenge statement:\nAny data leaving or entering the Mycoverse goes through our AI-backed deep packet inspection appliance. The vendor told us that this box was what we needed. At this price tag, I know he‚Äôs right. Why do you need DNS logs anyway? We both know that DNS servers are just address books of Internet resources and I‚Äôve never seen anyone abuse a plain old address book. The appliance would have blocked anything malicious anyway. I bet you don‚Äôt even have a certification to understand the protocol anyway. Don‚Äôt waste your time on the network capture, I skimmed throught it and found that your test device fd00:6e73:6563:3232::beef did nothing suspicious. Rosie Meyer - A+, Server+, CCNA, CCNP, CCIE, MSDST, CSM Network Admin We need to download the pcap. This is going to be the same pcap for all Portobello challenges.\nWe can start by taking a look at what we have. In wireshark, we can use the following filter to see only what is related to the ip at hand ipv6.src == fd00:6e73:6563:3232::beef || ipv6.dst == fd00:6e73:6563:3232::beef.\nWe can see that the subdomain to lag-dns-cannot-be-abused-pinky-swear.ctf in the first query is f, then o, then r\u0026hellip; So we can keep scrolling trying to see what it could be. We end up very soon on the word flag:\nforgetspaceaboutspacesafespaceprotocolsspace flag dashd\u0026hellip;\nWe can filter on queries only, and see even better what is getting written out:\nBy reading it until we get to the next \u0026ldquo;space\u0026rdquo; word, we can get the first flag.\n flag-dns-as-covert-communication-channels\n Flag submission:\nPortobello 53 - Denial (1/2) | 1 | I hope the server can interpret covert queries (1/2) Forum message:\nI bet this is just a malformed DNS query. There‚Äôs no way a server would answer to this. The forum message was the hint for the other flag. The answer is key to understanding which subdomain is important.\nLooking at the patterns, we can see that there is a lot less successful responses than NXDOMAIN. We can filter them and get all the successful answer\u0026rsquo;s subdomains together with this:\n$ tshark -r portobello53.pcapng -Y \u0026#34;ipv6.dst == fd00:6e73:6563:3232::beef\u0026#34; | grep pinky | grep -v \u0026#34;No such\u0026#34; | awk \u0026#39;{print $13}\u0026#39; | cut -d. -f1 | tr -d \u0026#39;\\n\u0026#39; flagdashdnsdashserverhidinginternetnoise This gives us the flag:\n flag-dns-serverhidinginternetnoise\n Flag submission:\nPortobello 53 - Denial (2/2) | 1 | Ouch - A two-way covert communication channel. Watch the client proceed to the next stage of grief (2/2) Forum message:\nA server answering correctly to your arbitrary DNS queries. That‚Äôs not the kind of thing that would take the Mycoverse down. "},{"uri":"https://n1trate.github.io/writeups/nsec-2022/portobello-depression/","title":"Portobello - Depression","tags":[],"description":"","content":"Challenge statement:\nWhat do you want again? Don‚Äôt you think you‚Äôve caused enough harm to the company already? Cyber security is only an expense. You can‚Äôt profit from being secure. It is a money drain. Our AI-based deep packet inspection appliance is guaranteed to prevent theft from the Mycoverse. There is nothing left to uncover from the network traffic of the DNS server, I swear. DNS is a safe protocol when you stick to ASCII characters and our appliance only supports this encoding. Even if someone can infiltrate the Mycoverse, there is no way that they can get our intelectual property out of the network. üö© This is making me think ü§î Are the DNS queries made by our users only in ASCII? Rosie Meyer - A+, Server+, CCNA, CCNP, CCIE, MSDST, CSM Network Admin We still need to download the same pcap.\nThrough the pcap, we can see some interesting queries being made that start with xn\u0026ndash;. This type of encoding is named punycode and allows us to use unicode in places where you usually can\u0026rsquo;t.\nWe can use an online converter to get the unicode character out of them.\nTo get a better look, we can filter only for the IP making those queries, fd00:6e73:6563:3232::9 and only for DNS queries of type CNAME.\nDoing the first few by hand, we get to the fifth one and find something that could look like the start of a flag.\nWe now had to figure out which country each flag was, and replace the flags with the county\u0026rsquo;s code from the unicode character. An easy way that I used was to paste them in discord, and hovering with the mouse to get the emoji\u0026rsquo;s name. That way, we get most of the flag:\n FLAG-ART-SCRE??SH??-IS-??GITAL-TH??T\n We\u0026rsquo;re missing a few flags, but we can guess the rest\n FLAG-ART-SCREENSHOT-IS-DIGITAL-THEFT\n Flag submission:\nPortobello 53 - Depression (1/3) | 2 | The Mycoverse needs it‚Äôs own flag (1/3) Forum message:\nThe user found a way to exfiltrate informations using country flags? Where can I get a certification for this? After that, I kept going and reading the other domains. It was pretty fun and got some like that one:\nI did a dozen or two by hand, and this is what I got:\nAt that point, that last line, I knew what it was\u0026hellip; \u0026ldquo;UPLOAD START\u0026rdquo;\u0026hellip; and no, I didn\u0026rsquo;t want to keep doing it by hand. There was a total of 1223 packets that were containing a punycode CNAME\u0026hellip;.\nTime to bring out bash once again:\ntshark -r portobello53.pcapng | grep libera | grep \u0026#34;query 0x\u0026#34; | awk {\u0026#39;print $12\u0026#39;} Sending them all in a file, we can use this Punycode Converter to do more than one at a time. Loading the file with \u0026ldquo;Import Urls\u0026rdquo; and selecting \u0026ldquo;Punycode to IDN\u0026rdquo;. Scrolling down, we can start to see some form that are letters. Here\u0026rsquo;s the first one:\nBy zooming the way down to 25% we can get a better view.\nBy the way, the mushroom at the start are now very nice looking!# We can keep reading the flag, as such:\nWe then end up with:\n FLAG-ART-MUSHROOM-ARE-HIDDEN-IN-PLAIN-SIGHT\n Flag submission:\nPortobello 53 - Depression (2/3) | 1 | Is a VFT screenshot actually art theft? (2/3) Forum message:\nUsers are stealing artwork and VFTs from the Mycoverse. I need to tell the cyberpolice. At the absolute end, we get those:\nThat last command is SLEEP, but before that, we can see a nice QR Code. I say nice, but trying to read it using 5 to 10 tools, including my phone, were all unsuccessful.\nKnowing that the first thing the readers need to parse a QR Code is to recognize the Finder Patterns, and the Alignment Pattern. I did a quick and dirty work in Pinta to make sure those were clear enough:\nWith those modifications, my phone was able to read it and give me the last flag.\n FLAG-ART-EXFIL-METHOD-IS-TRUE-MASTERPIECE\n Flag submission:\nPortobello 53 - Depression (3/3) | 3 | Why invest in YRR when their art can be stolen that easily? Good grief. (3/3) Forum message:\nThat is another level of obfuscation that our AI-based appliance was not ready to deal with. "},{"uri":"https://n1trate.github.io/writeups/nsec-2022/portobello-bargaining/","title":"Portobello - Bargaining","tags":[],"description":"","content":"Challenge statement:\nWhile you were wasting your time on the DNS server trafic, I had Dr Harold Moon, our resident data scientist, verify if he could find anything out of the ordinary. He‚Äôs not an expert and has no active certifications under his name but he wanted you to know that the host at address fd00:6e73:6563:3232::23 was the only one presenting anomalies. I am not a data scientist and have no idea what anomalies are. It‚Äôs probably benign because the AI-backed deep packet inspection appliance did not flag anything. Dr Moon said he observed a lot of unusual ‚Äúback and forth‚Äù with this address. No appliance alert = not suspicious in my book. Rosie Meyer - A+, Server+, CCNA, CCNP, CCIE, MSDST, CSM Network Admin We still need to download the same pcap.\nWe can start by filtering the same way we did in Denial, but with the right IP address (fd00:6e73:6563:3232::23).\nWe can see some interesting calls make, like packet 1053, where the query has the word \u0026ldquo;echo\u0026rdquo; in it. The subdomain to echo also look like a string we should be able to convert.\n0.7666742d7365637572652d7661756c742e7972722e636f7270.echo.474f415453.wpad.ctf The second section 7666742d7365637572652d7661756c742e7972722e636f7270 can be translated to vft-secure-vault.yrr.corp and the fourth one 474f415453 to GOATS. That one appears in every interesting request.\nWe can keep going by hand and finding other packets, like 1522, where the second value translate to rosie.meyer, but we should do it with some kind of script, else it will take a long time.\ntshark -r portobello53.pcapng | grep wpad.ctf | grep \u0026#34;query 0x\u0026#34; | awk {\u0026#39;print $12\u0026#39;} | grep echo | cut -d. -f2 | xxd -r -p We can find out first flag in the middle, right after the wallet\u0026rsquo;s private key.\n flag-blockchaiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiin\n It was actually the second flag, or the third one\u0026hellip; I think there was a little issue with the numbering on that one.\nFlag submission:\nPortobello 53 - Bargaining (3/3) | 2 | Losing this private key is not looking great (2/3) I didn\u0026rsquo;t go check the forums before finding the next flag, but there was a new message hinting us on how to do the last one.\nForum message:\nOur AI appliance was supposed to catch anything malicious and yet it let the private key to our wallet get leaked. This is bad for the company. Can you also tell me which CVE was used to do priviledge escalation? I want to get ready to blame someone else. Use this format: flag-bargaining_{MD5 hash of the string CVE-XXXX-YYYYYYYYYY} (without the {}). For the first flag, I kept looking into wireshark and ended up around packet 2218 where we can clearly see some data in the hexadecimal reprensentation.\nTaking that packet and the next ones together, we can recreate the flag.\n FLAG-we_have_a_bad_case_of_ophiocordyceps_unilateralis\n Flag submission:\nPortobello 53 - Bargaining (1/3) | 2 | Why is that server returning commands? (1/3) Forum message:\nThe DNS server is definitely sending commands to the host. What could go wrong? For the last flag, we had to find the message on the forum. We can see from other packets that we see a query to get the version of sudo, and an execution of sudo -u#-1 /bin/bash. Looking for that specific version of sudo that we got earlier (1.8.27), lead us to an exploit-db page informing us of the CVE : 2019-14287.\nWe can use md5sum to generate the hash and submit our last flag.\n flag-bargaining_739d80f289f091f1d5faf12cfd25fe83\n Flag submission:\nPortobello 53 - Bargaining (2/3) | 1 | A yes, a good old MITRE ATT@CK T1548. Give us ways to cope on grief. (3/3) Forum message:\nSomeone logged in as myself and managed to escalate their priviledges. Don‚Äôt tell the news. "},{"uri":"https://n1trate.github.io/writeups/nsec-2022/portobello-anger/","title":"Portobello - Anger","tags":[],"description":"","content":"Challenge statement:\nYOU HAVE NO RIGHTS TO USE THE DNS PROTOCOL MALICIOUSLY. Respect the RFCs spirit like any good technology user would. Our vendor guaranteed us that nothing could get stolen from the Mycoverse and I still believe him. Because any data leaving or entering the Mycoverse goes through our AI-backed deep packet inspection appliance, we have never had any user misuse our technologies. They have no need to do so because anything a user would want is acquireable through our online store. My AI appliance alerted me numerous time about large DNS responses from a single domain name but I deleted these alerts as false positives. I don‚Äôt want to sound like a broken record but we both know that DNS is a benign protocol. You can still try to find the traffic, I bet it is still happening. Rosie Meyer - A+, Server+, CCNA, CCNP, CCIE, MSDST, CSM Network Admin We still need to download the same pcap.\nThe large DNS responses that the challenge statement is talking about can be found in the TXT records. We can see a lot of query and responses for TXT records in the why-pay-for-bits-when-you-can-drop-the-beats.ctf.\nTaking the first one, we can see that the content of the TXT response look like a base64 blob.\nWe can use base64 to get some clear-ish text:\necho \u0026#34;SUQzAwAAAAABFFRQRTEAAAAQAAAAUzNSTCBmdCBLcnlzdGFsVElUMgAAABYAAABUcmlwcGluZyBvbiBNdXNocm9vbXNDT01NAAAAIwAAAAAAAABmbGFnLXJhZGlvLW15Y292ZXJzZS1pcy1hLXNjYW1DT01NAAAAIwAAAFhYWABmbGFnLXJhZGlvLW15Y292ZXJzZS1pcy1hLXNjYW3/+5REAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u0026#34; | base64 -d ID3TPE1S3RL ft KrystalTIT2Tripping on MushroomsCOMM#flag-radio-mycoverse-is-a-scamCOMM#XXXflag-radio-mycoverse-is-a-scamÔøΩÔøΩÔøΩD We can see the first flag in there.\n flag-radio-mycoverse-is-a-scam\n Flag submission:\nPortobello 53 - Anger (1/2) | 1 | This user did not buy this art on the Mycoverse (1/2) Forum message:\nWhat is that user downloading illegaly from a non-official server? We can see that the previous blob was binary, and started with ID3. We can have a better look at it by sending it to hexdump -C:\nID3 is a metadata container usually used in MP3. We can try to extract all the TXT record and create a single file out of them with this script:\nfrom scapy.all import * import base64  raw = sniff(offline=\u0026#34;portobello53.pcapng\u0026#34;)  data = b\u0026#39;\u0026#39;  for packet in raw:  if packet[IPv6].src == \u0026#39;fd00:6e73:6563:3232::100\u0026#39; and b\u0026#39;why-pay-for-bits-when-you-can-drop-the-beats\u0026#39; in packet[DNS].qd.qname and packet[DNS].ancount \u0026gt; 0:  data = data + packet[DNS].an.rdata[0]  with open(\u0026#39;output\u0026#39;, \u0026#39;wb\u0026#39;) as f:  f.write(base64.b64decode(data)) We can now use the file command to make sure what type of file it is:\n$ file output output: Audio file with ID3 version 2.3.0, contains:MPEG ADTS, layer III, v1, 128 kbps, 48 kHz, JntStereo It\u0026rsquo;s a bit hard to hear correctly, but when opening the file in an audio player, we can hear the last flag (SOUND WARNING).\n flag-radiocashmoneymushroom247\n Flag submission:\nPortobello 53 - Anger (2/2) | 2 | When the beat drops, expect the stocks to do the same. This gives me grief. (2/2) Forum message:\nListening to pirated radio channel from within the Mycoverse. I will let Eva and Anatoli know that we are missing out on profit. "},{"uri":"https://n1trate.github.io/writeups/nsec-2022/","title":"NSec 2022","tags":[],"description":"","content":"The NSec CTF was on May 20-21-22, 2022. As with every NSec CTF, there was a theme, and this year\u0026rsquo;s theme is Mushrooms and NFTs.\n"},{"uri":"https://n1trate.github.io/writeups/_footer/","title":"","tags":[],"description":"","content":"Weeeeeeeeeeeeeeee\n"},{"uri":"https://n1trate.github.io/writeups/categories/","title":"Categories","tags":[],"description":"","content":""},{"uri":"https://n1trate.github.io/writeups/tags/","title":"Tags","tags":[],"description":"","content":""},{"uri":"https://n1trate.github.io/writeups/tools/","title":"Tools","tags":[],"description":"","content":"https://www.cryptool.org/en/cto/\nhttps://www.asciitohex.com/\n"},{"uri":"https://n1trate.github.io/writeups/","title":"Writeups","tags":[],"description":"","content":"Writeups Hello.\nWorld.\n"}]